<import src="../../templates/ai-chat-template.wxml" />
<navigation-bar title="é¥®é£Ÿè®°å½• ğŸš" back="{{false}}" color="white"
  background="linear-gradient(135deg, #FFB6C1, #FFD700)"></navigation-bar>

<view class="container">
  <view class="bear-calendar">
    <!-- æ ‡é¢˜æ  -->
    <view class="bear-calendar-titlebar">
      <view class="bear-arrow left" bindtap="prevMonth">
        <view class="arrow-left"></view>
      </view>
      <text class="bear-calendar-month">{{year}}å¹´{{month}}æœˆ</text>
      <view class="bear-arrow right" bindtap="nextMonth">
        <view class="arrow-right"></view>
      </view>
    </view>

    <!-- æ˜ŸæœŸè¡Œ -->
    <view class="bear-calendar-weekdays">
      <view wx:for="{{weekdays}}" wx:key="id" class="bear-weekday-item">
        {{item}}
      </view>
    </view>

    <!-- æ—¥æœŸéƒ¨åˆ† -->
    <view class="bear-calendar-days">
      <block wx:for="{{calendarData}}" wx:key="index">
        <view class="bear-week" wx:if="{{calendarExpanded || index === currentWeekIndex}}">
          <!-- å±•å¼€æ˜¾ç¤ºæ‰€æœ‰å‘¨ï¼Œé»˜è®¤æ˜¾ç¤ºå½“å¤©æ‰€åœ¨çš„å‘¨ -->
          <block wx:for="{{item}}" wx:key="index">
            <block wx:if="{{item === 0}}">
              <view class="bear-day empty"></view>
            </block>
            <block wx:else>
              <view class="bear-day {{item === selectedDay ? 'selected' : ''}} {{today && item === day ? 'today' : ''}}"
                bindtap="selectDate" data-value="{{item}}">
                <text>{{item}}</text>
              </view>
            </block>
          </block>
        </view>
      </block>
    </view>

    <!-- å±•å¼€/æ”¶èµ·æŒ‰é’® -->
    <view class="calendar-toggle" bindtap="toggleCalendar">
      <view wx:if="{{calendarExpanded}}">
        <icon type="success_no_circle" size="30" class="toggle-icon expanded"></icon>
      </view>
      <view wx:else>
        <icon type="success" size="30" class="toggle-icon collapsed"></icon>
      </view>
    </view>
  </view>

  <view class="diet-container">
    <view class="diet-header">
      <text class="diet-title">ğŸ¾ å½“æ—¥é¥®é£Ÿ</text>
      <view class="diet-summary">
        <view class="summary-item">
          <text>ğŸ”¥ æ€»çƒ­é‡: {{totalCalories ? totalCalories : '0'}} kcal</text>
        </view>
        <view class="summary-item">
          <text>ğŸ³ æ€»è›‹ç™½è´¨: {{totalProtein ? totalProtein : '0'}} g</text>
        </view>
        <view class="summary-item">
          <text>ğŸ¥© æ€»è„‚è‚ª: {{totalFat ? totalFat : '0'}} g</text>
        </view>
      </view>
    </view>

    <scroll-view scroll-y class="diet-list">
      <view wx:for="{{dietRecords}}" wx:key="id" class="diet-item {{item.mealType}}">
        <view class="diet-item-header">
          <text class="meal-type">{{item.mealType}}</text>
          <text class="food-name">{{item.food_name}}</text>
        </view>
        <view class="diet-item-details">
          <text>é‡é‡: {{item.weight}}g</text>
          <text>çƒ­é‡: {{item.calories}} kcal</text>
          <text>è›‹ç™½è´¨: {{item.protein}}g</text>
          <text>è„‚è‚ª: {{item.fat}}g</text>
        </view>
      </view>
    </scroll-view>
  </view>


</view>


<template is="ai-chat-button" data="{{showAIChat, userInfo}}" />
<template is="ai-chat-modal" data="{{showAIChat, userInfo, messages, inputMessage}}" />