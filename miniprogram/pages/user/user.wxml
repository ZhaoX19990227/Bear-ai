<view class="user-page bear-theme glass-effect">
  <!-- 顶部 AI按钮 -->
  <view class="ai-button-container">
    <button class="ai-button" bindtap="openAiAssistant">AI助手</button>
  </view>

  <!-- 用户头像和昵称卡片 -->
  <view class="user-info-card glass-card">
    <image src="/images/avatar.png" class="avatar" />
    <view class="user-details">
      <text class="username">{{userInfo.nickname}}</text>
    </view>
  </view>

  <!-- 用户基本信息卡片 -->
  <view class="user-detail-card glass-card">
    <text class="card-title">基本信息</text>
    <view class="info-item">年龄：{{userInfo.age}}岁</view>
    <view class="info-item">身高：{{userInfo.height}}cm</view>
    <view class="info-item">体重：{{userInfo.weight}}kg</view>
  </view>

  <!-- 底部功能入口 -->
  <view class="bottom-functions">
    <view class="function-item" bindtap="contactAuthor">
      <image src="/images/friend.JPG" class="function-icon" mode="aspectFit"></image>
    </view>
  </view>
</view>
<!-- AI 聊天入口 -->
<view 
  class="ai-chat-button" 
  bindtap="onAIChatClick"
>
  <image 
    src="https://attach-sit.oss-cn-shanghai.aliyuncs.com/default/28a14b07da0d4e7684758a48649b5ad9.png?1=1" 
    class="ai-avatar"
  ></image>
</view>

<!-- AI 聊天模态框 -->
<view class="cu-modal {{showAIChat?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">AI 助手</view>
      <view class="action" bindtap="hideAIChat">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <scroll-view 
      scroll-y 
      class="chat-messages" 
      scroll-with-animation 
      scroll-into-view="msg-{{messages.length-1}}"
    >
      <block wx:for="{{messages}}" wx:key="index">
        <view 
          id="msg-{{index}}"
          class="chat-message {{item.type === 'user' ? 'user-message' : 'ai-message'}}"
        >
          <image 
            src="{{item.type === 'user' ? userInfo.avatarUrl : 'https://attach-sit.oss-cn-shanghai.aliyuncs.com/default/28a14b07da0d4e7684758a48649b5ad9.png?1=1'}}" 
            class="chat-avatar"
          ></image>
          <view class="message-content">
            <text class="message-text">{{item.content}}</text>
            <view wx:if="{{item.fileUrl}}" class="message-file">
              <image 
                src="{{item.fileUrl}}" 
                mode="aspectFill" 
                class="message-image"
              ></image>
            </view>
          </view>
        </view>
      </block>
    </scroll-view>
    <view class="cu-bar input">
      <view class="input-group">
        <view class="file-upload" bindtap="chooseFile">
          <text class="cuIcon-upload"></text>
        </view>
        <input 
          class="cu-input" 
          placeholder="🐾 您想问小肉熊什么捏～" 
          confirm-type="send"
          bindinput="onInputChange"
          bindconfirm="sendMessage"
          value="{{inputMessage}}"
        ></input>
        <view class="send-btn" bindtap="sendMessage">
          <text class="cuIcon-right"></text>
        </view>
      </view>
    </view>
  </view>
</view>