<import src="../../templates/ai-chat-template.wxml" />
<navigation-bar title="🐻‍❄️ 首页 🏠" back="{{false}}" color="white" background="linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)"></navigation-bar>

<view class="container">
  <!-- 轮播图 -->
  <swiper 
    class="card-swiper" 
    indicator-dots="{{true}}" 
    circular="{{true}}" 
    autoplay="{{true}}" 
    interval="3000" 
    duration="500"
  >
    <swiper-item wx:for="{{swiperList}}" wx:key="index" class="{{item.type}}">
      <view 
        class="swiper-item" 
        style="background-image:url({{item.url}})"
        bindtap="onSwiperItemTap"
        data-id="{{item.id}}"
      >
        <view class="swiper-title">{{item.title}}</view>
      </view>
    </swiper-item>
  </swiper>




  <!-- 今日饮食容器 -->
  <view class="diet-container">
    <view class="diet-title-container">
    <view class="diet-title">今日饮食</view>
    <view class="add-diet-btn" bindtap="showAddDietModal">
      <text class="cuIcon-add"></text>
    </view>
  </view>
    <!-- 今日饮食总览 -->
    <view class="diet-summary">
        <view class="summary-item">
        <text class="label">热量</text>
        <text class="value">{{totalCalories}} 千卡</text>
      </view>
      <view class="summary-item">
        <text class="label">蛋白质</text>
        <text class="value">{{totalProtein}} 克</text>
      </view>
      <view class="summary-item">
        <text class="label">脂肪</text>
        <text class="value">{{totalFat}} 克</text>
      </view>
    </view> 

    <!-- 今日饮食记录列表 -->
    <scroll-view 
      scroll-y 
      class="diet-records-list" 
      wx:if="{{groupedDietRecords.length > 0}}"
    >
      <block wx:for="{{groupedDietRecords}}" wx:key="mealType">
        <view class="diet-meal-group">
          <view class="diet-meal-type">{{item.mealType}}</view>
          <block wx:for="{{item.records}}" wx:key="index" wx:for-item="record">
            <view class="cu-item diet-record">
              <view class="diet-record-content">
                <text class="diet-record-name">{{record.foodName}}</text>
                <view class="diet-record-details">
                  <text>热量：{{record.calories}} 千卡</text>
                  <text>蛋白质：{{record.protein}} 克</text>
                  <text class="diet-record-time">{{record.time}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- 健康资讯 -->
  <view class="article-section">
    <view class="section-title">健康资讯</view>
    <view class="cu-list menu-card">
      <block wx:for="{{articleList}}" wx:key="index">
        <view class="cu-item" bindtap="onArticleClick" data-id="{{item.id}}">
          <view class="cu-avatar" style="background-image:url({{item.cover}})"></view>
          <view class="content">
            <view class="text-black">{{item.title}}</view>
            <view class="text-gray text-sm">{{item.summary}}</view>
          </view>
          <view class="action">
            <text class="cuIcon-right text-gray"></text>
          </view>
        </view>
      </block>
    </view>
  </view>
</view>

<!-- 添加饮食记录模态框 -->
<view class="cu-modal {{showAddDietModal?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">添加饮食记录</view>
      <view class="action" bindtap="hideAddDietModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding">
      <!-- 餐次类型选择 -->
      <view class="cu-form-group">
        <view class="title">餐次类型</view>
        <picker 
          mode="selector" 
          range="{{mealTypes}}" 
          value="{{selectedMealTypeIndex}}" 
          bindchange="onMealTypeChange"
        >
          <view class="picker">
            {{mealTypes[selectedMealTypeIndex]}}
          </view>
        </picker>
      </view>
      
      <!-- 食物名称输入 -->
     <view class="input-container">
    <input 
      type="text" 
      placeholder="食物名称" 
      value="{{foodName}}" 
      bindinput="onFoodNameInput"
      style="flex: 1; margin-right: 5rpx; height: 60rpx;"
    />
    <input 
      type="number" 
      placeholder="食物重量 (g)" 
      value="{{newDietRecord.weight}}" 
      bindinput="onFoodWeightInput"
      style="flex: 1; height: 60rpx;"
    />
  </view>
  <button 
    class="search-food-btn bg-brown block " 
    disabled="{{isButtonDisabled}}"
    bindtap="searchFoodByName"
  >
    <text class="cuIcon-search"></text>
  </button>
      
      <!-- 热量 -->
      <view class="cu-form-group">
        <view class="title">热量 (千卡{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="请输入热量" 
          bindinput="onCaloriesInput"
          value="{{newDietRecord.calories}}"
        ></input>
      </view>
      
      <!-- 蛋白质 -->
      <view class="cu-form-group">
        <view class="title">蛋白质 (克{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="请输入蛋白质含量" 
          bindinput="onProteinInput"
          value="{{newDietRecord.protein}}"
        ></input>
      </view>
      
      <!-- 脂肪 -->
      <view class="cu-form-group">
        <view class="title">脂肪 (克{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="请输入脂肪含量" 
          bindinput="onFatInput"
          value="{{newDietRecord.fat}}"
        ></input>
      </view>
      
      <!-- 确认按钮 -->
      <button 
        class="cu-btn block bg-brown margin-top" 
        bindtap="confirmAddDietRecord"
      >
        确认添加
      </button>
      <text class="data-source">🐻 数据来源：fatsecret</text>
    </view>
  </view>
  
</view>



<template is="ai-chat-button" />
<template is="ai-chat-modal" />