<import src="../../templates/ai-chat-template.wxml" />
<navigation-bar title="é¦–é¡µ ğŸ " back="{{false}}" color="white" background="linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)"></navigation-bar>

<view class="container">
  <!-- è½®æ’­å›¾ -->
  <swiper 
    class="card-swiper" 
    indicator-dots="{{true}}" 
    circular="{{true}}" 
    autoplay="{{true}}" 
    interval="3000" 
    duration="500"
  >
    <swiper-item wx:for="{{swiperList}}" wx:key="index" class="{{item.type}}">
      <view 
        class="swiper-item" 
        style="background-image:url({{item.url}})"
        bindtap="onSwiperItemTap"
        data-id="{{item.id}}"
      >
        <view class="swiper-title">{{item.title}}</view>
      </view>
    </swiper-item>
  </swiper>
  <!-- ä»Šæ—¥é¥®é£Ÿå®¹å™¨ -->
  <view class="diet-container">
    <view class="diet-title-container">
    <view class="diet-title">ä»Šæ—¥é¥®é£Ÿ</view>
    <view class="add-diet-btn" bindtap="showAddDietModal">
      <text class="cuIcon-add"/>
    </view>
  </view>
    <!-- ä»Šæ—¥é¥®é£Ÿæ€»è§ˆ -->
    <view class="diet-summary">
        <view class="summary-item">
        <text class="label">ğŸ”¥</text>
        <text class="value">{{totalCalories}} åƒå¡</text>
      </view>
      <view class="summary-item">
        <text class="label">ğŸ³</text>
        <text class="value">{{totalProtein}} å…‹</text>
      </view>
      <view class="summary-item">
        <text class="label">ğŸ¥©</text>
        <text class="value">{{totalFat}} å…‹</text>
      </view>
    </view> 

    <!-- ä»Šæ—¥é¥®é£Ÿè®°å½•åˆ—è¡¨ -->
    <scroll-view 
      scroll-y 
      class="diet-records-list" 
      wx:if="{{groupedDietRecords.length > 0}}"
    >
      <block wx:for="{{groupedDietRecords}}" wx:key="mealType">
        <view class="diet-meal-group">
          <view class="diet-meal-type">{{item.mealType}}</view>
          <block wx:for="{{item.records}}" wx:key="index" wx:for-item="record">
            <view class="cu-item diet-record">
              <view class="diet-record-content">
                <text class="diet-record-name">{{record.food_name}} - {{record.weight}}å…‹</text>
                <view class="diet-record-details">
                  <text>çƒ­é‡ï¼š{{record.calories}} åƒå¡</text>
                  <text>è›‹ç™½è´¨ï¼š{{record.protein}} å…‹</text>
                  <text>è„‚è‚ªï¼š{{record.fat}} å…‹</text>
                  <text class="diet-record-time">{{record.time}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
      </block>
    </scroll-view>
  </view>
</view>

<!-- æ·»åŠ é¥®é£Ÿè®°å½•æ¨¡æ€æ¡† -->
<view class="cu-modal {{showAddDietModal?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">æ·»åŠ é¥®é£Ÿè®°å½•</view>
      <view class="action" bindtap="hideAddDietModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding">

      <view class="cu-form-group">
        <view class="title">é¤æ¬¡ç±»å‹</view>
        <picker 
          mode="selector" 
          range="{{mealTypes}}" 
          value="{{newDietRecord.mealType}}" 
          bindchange="onMealTypeChange"
        >
          <view class="picker">
            {{newDietRecord.mealType}}
          </view>
        </picker>
      </view>
      

     <view class="input-container">
    <input 
      type="text" 
      placeholder="{{foodNamePlaceholder}}" 
      value="{{newDietRecord.foodName}}" 
      bindinput="onFoodNameInput"
      bindfocus="onFoodNameFocus"
      bindblur="onFoodNameBlur"
      style="flex: 1; margin-right: 5rpx; height: 60rpx;"
    />
    <input 
      type="number" 
      placeholder="{{weightPlaceholder}}" 
      value="{{newDietRecord.weight}}" 
      bindinput="onFoodWeightInput"
      bindfocus="onFoodWeightFocus"
      bindblur="onFoodWeightBlur"
      style="flex: 1; height: 60rpx;"
    />
  </view>
  <button 
    class="search-food-btn bg-brown block " 
    disabled="{{isButtonDisabled}}"
    bindtap="searchFoodByName"
  >
    <text class="cuIcon-search"></text>
  </button>
      

      <view class="cu-form-group">
        <view class="title">çƒ­é‡ (åƒå¡{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="è¯·è¾“å…¥çƒ­é‡" 
          bindinput="onCaloriesInput"
          value="{{newDietRecord.calories}}"
        ></input>
      </view>
      

      <view class="cu-form-group">
        <view class="title">è›‹ç™½è´¨ (å…‹{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="è¯·è¾“å…¥è›‹ç™½è´¨å«é‡" 
          bindinput="onProteinInput"
          value="{{newDietRecord.protein}}"
        ></input>
      </view>
      

      <view class="cu-form-group">
        <view class="title">è„‚è‚ª (å…‹{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="è¯·è¾“å…¥è„‚è‚ªå«é‡" 
          bindinput="onFatInput"
          value="{{newDietRecord.fat}}"
        ></input>
      </view>
      

      <button 
        class="cu-btn block bg-brown margin-top" 
        bindtap="confirmAddDietRecord"
      >
        ç¡®è®¤æ·»åŠ 
      </button>
      <text class="data-source">ğŸ» æ•°æ®æ¥æºï¼šfatsecret</text>
    </view>
  </view>
  
</view>



<template is="ai-chat-button" data="{{showAIChat, userInfo}}" />
<template is="ai-chat-modal" data="{{showAIChat, userInfo, messages, inputMessage}}"/>