<import src="../../templates/ai-chat-template.wxml" />
<navigation-bar title="ğŸ»â€â„ï¸ é¦–é¡µ ğŸ " back="{{false}}" color="white" background="linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)"></navigation-bar>

<view class="container">
  <!-- è½®æ’­å›¾ -->
  <swiper 
    class="card-swiper" 
    indicator-dots="{{true}}" 
    circular="{{true}}" 
    autoplay="{{true}}" 
    interval="3000" 
    duration="500"
  >
    <swiper-item wx:for="{{swiperList}}" wx:key="index" class="{{item.type}}">
      <view 
        class="swiper-item" 
        style="background-image:url({{item.url}})"
        bindtap="onSwiperItemTap"
        data-id="{{item.id}}"
      >
        <view class="swiper-title">{{item.title}}</view>
      </view>
    </swiper-item>
  </swiper>




  <!-- ä»Šæ—¥é¥®é£Ÿå®¹å™¨ -->
  <view class="diet-container">
    <view class="diet-title-container">
    <view class="diet-title">ä»Šæ—¥é¥®é£Ÿ</view>
    <view class="add-diet-btn" bindtap="showAddDietModal">
      <text class="cuIcon-add"></text>
    </view>
  </view>
    <!-- ä»Šæ—¥é¥®é£Ÿæ€»è§ˆ -->
    <view class="diet-summary">
        <view class="summary-item">
        <text class="label">çƒ­é‡</text>
        <text class="value">{{totalCalories}} åƒå¡</text>
      </view>
      <view class="summary-item">
        <text class="label">è›‹ç™½è´¨</text>
        <text class="value">{{totalProtein}} å…‹</text>
      </view>
      <view class="summary-item">
        <text class="label">è„‚è‚ª</text>
        <text class="value">{{totalFat}} å…‹</text>
      </view>
    </view> 

    <!-- ä»Šæ—¥é¥®é£Ÿè®°å½•åˆ—è¡¨ -->
    <scroll-view 
      scroll-y 
      class="diet-records-list" 
      wx:if="{{groupedDietRecords.length > 0}}"
    >
      <block wx:for="{{groupedDietRecords}}" wx:key="mealType">
        <view class="diet-meal-group">
          <view class="diet-meal-type">{{item.mealType}}</view>
          <block wx:for="{{item.records}}" wx:key="index" wx:for-item="record">
            <view class="cu-item diet-record">
              <view class="diet-record-content">
                <text class="diet-record-name">{{record.foodName}}</text>
                <view class="diet-record-details">
                  <text>çƒ­é‡ï¼š{{record.calories}} åƒå¡</text>
                  <text>è›‹ç™½è´¨ï¼š{{record.protein}} å…‹</text>
                  <text class="diet-record-time">{{record.time}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- å¥åº·èµ„è®¯ -->
  <view class="article-section">
    <view class="section-title">å¥åº·èµ„è®¯</view>
    <view class="cu-list menu-card">
      <block wx:for="{{articleList}}" wx:key="index">
        <view class="cu-item" bindtap="onArticleClick" data-id="{{item.id}}">
          <view class="cu-avatar" style="background-image:url({{item.cover}})"></view>
          <view class="content">
            <view class="text-black">{{item.title}}</view>
            <view class="text-gray text-sm">{{item.summary}}</view>
          </view>
          <view class="action">
            <text class="cuIcon-right text-gray"></text>
          </view>
        </view>
      </block>
    </view>
  </view>
</view>

<!-- æ·»åŠ é¥®é£Ÿè®°å½•æ¨¡æ€æ¡† -->
<view class="cu-modal {{showAddDietModal?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">æ·»åŠ é¥®é£Ÿè®°å½•</view>
      <view class="action" bindtap="hideAddDietModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>
    <view class="padding">
      <!-- é¤æ¬¡ç±»å‹é€‰æ‹© -->
      <view class="cu-form-group">
        <view class="title">é¤æ¬¡ç±»å‹</view>
        <picker 
          mode="selector" 
          range="{{mealTypes}}" 
          value="{{selectedMealTypeIndex}}" 
          bindchange="onMealTypeChange"
        >
          <view class="picker">
            {{mealTypes[selectedMealTypeIndex]}}
          </view>
        </picker>
      </view>
      
      <!-- é£Ÿç‰©åç§°è¾“å…¥ -->
     <view class="input-container">
    <input 
      type="text" 
      placeholder="é£Ÿç‰©åç§°" 
      value="{{foodName}}" 
      bindinput="onFoodNameInput"
      style="flex: 1; margin-right: 5rpx; height: 60rpx;"
    />
    <input 
      type="number" 
      placeholder="é£Ÿç‰©é‡é‡ (g)" 
      value="{{newDietRecord.weight}}" 
      bindinput="onFoodWeightInput"
      style="flex: 1; height: 60rpx;"
    />
  </view>
  <button 
    class="search-food-btn bg-brown block " 
    disabled="{{isButtonDisabled}}"
    bindtap="searchFoodByName"
  >
    <text class="cuIcon-search"></text>
  </button>
      
      <!-- çƒ­é‡ -->
      <view class="cu-form-group">
        <view class="title">çƒ­é‡ (åƒå¡{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="è¯·è¾“å…¥çƒ­é‡" 
          bindinput="onCaloriesInput"
          value="{{newDietRecord.calories}}"
        ></input>
      </view>
      
      <!-- è›‹ç™½è´¨ -->
      <view class="cu-form-group">
        <view class="title">è›‹ç™½è´¨ (å…‹{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="è¯·è¾“å…¥è›‹ç™½è´¨å«é‡" 
          bindinput="onProteinInput"
          value="{{newDietRecord.protein}}"
        ></input>
      </view>
      
      <!-- è„‚è‚ª -->
      <view class="cu-form-group">
        <view class="title">è„‚è‚ª (å…‹{{weightUnit}})</view>
        <input 
          type="number" 
          placeholder="è¯·è¾“å…¥è„‚è‚ªå«é‡" 
          bindinput="onFatInput"
          value="{{newDietRecord.fat}}"
        ></input>
      </view>
      
      <!-- ç¡®è®¤æŒ‰é’® -->
      <button 
        class="cu-btn block bg-brown margin-top" 
        bindtap="confirmAddDietRecord"
      >
        ç¡®è®¤æ·»åŠ 
      </button>
      <text class="data-source">ğŸ» æ•°æ®æ¥æºï¼šfatsecret</text>
    </view>
  </view>
  
</view>



<template is="ai-chat-button" />
<template is="ai-chat-modal" />